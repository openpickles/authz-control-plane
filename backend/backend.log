WARNING: A terminally deprecated method in sun.misc.Unsafe has been called
WARNING: sun.misc.Unsafe::staticFieldBase has been called by com.google.inject.internal.aop.HiddenClassDefiner (file:/Users/mb/.sdkman/candidates/maven/current/lib/guice-5.1.0-classes.jar)
WARNING: Please consider reporting this to the maintainers of class com.google.inject.internal.aop.HiddenClassDefiner
WARNING: sun.misc.Unsafe::staticFieldBase will be removed in a future release
[INFO] Scanning for projects...
[INFO] 
[INFO] -------------------< org.openpickles:policy-engine >--------------------
[INFO] Building policy-engine 0.0.1
[INFO]   from pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] >>> spring-boot:4.0.0:run (default-cli) > test-compile @ policy-engine >>>
[INFO] 
[INFO] --- exec:3.1.1:exec (npm-install) @ policy-engine ---

up to date, audited 393 packages in 898ms

77 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
[INFO] 
[INFO] --- exec:3.1.1:exec (npm-build) @ policy-engine ---

> frontend@0.0.0 build
> vite build

vite v7.3.0 building client environment for production...
transforming...
✓ 2009 modules transformed.
rendering chunks...
computing gzip size...
dist/index.html                   0.47 kB │ gzip:   0.31 kB
dist/assets/index-RrdnHtpO.css   59.54 kB │ gzip:   9.88 kB
dist/assets/index-BIEM6BL8.js   436.72 kB │ gzip: 135.37 kB
✓ built in 1.74s
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ policy-engine ---
[INFO] Copying 1 resource from src/main/resources to target/classes
[INFO] Copying 1 resource from src/main/resources to target/classes
[INFO] 
[INFO] --- compiler:3.14.1:compile (default-compile) @ policy-engine ---
[INFO] Nothing to compile - all classes are up to date.
[INFO] 
[INFO] --- resources:3.3.1:testResources (default-testResources) @ policy-engine ---
[INFO] skip non existing resourceDirectory /Users/mb/workspace/policy-engine/backend/src/test/resources
[INFO] 
[INFO] --- compiler:3.14.1:testCompile (default-testCompile) @ policy-engine ---
[INFO] Nothing to compile - all classes are up to date.
[INFO] 
[INFO] <<< spring-boot:4.0.0:run (default-cli) < test-compile @ policy-engine <<<
[INFO] 
[INFO] 
[INFO] --- spring-boot:4.0.0:run (default-cli) @ policy-engine ---
[INFO] Attaching agents: []

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/

 :: Spring Boot ::                (v4.0.0)

2026-01-02 21:40:51.073 [main] INFO  o.o.p.engine.PolicyEngineApplication - [] - Starting PolicyEngineApplication using Java 24.0.1 with PID 74272 (/Users/mb/workspace/policy-engine/backend/target/classes started by mb in /Users/mb/workspace/policy-engine/backend)
2026-01-02 21:40:51.074 [main] DEBUG o.o.p.engine.PolicyEngineApplication - [] - Running with Spring Boot v4.0.0, Spring v7.0.1
2026-01-02 21:40:51.074 [main] INFO  o.o.p.engine.PolicyEngineApplication - [] - No active profile set, falling back to 1 default profile: "default"
2026-01-02 21:40:51.194 [background-preinit] INFO  o.h.validator.internal.util.Version - [] - HV000001: Hibernate Validator 9.0.1.Final
2026-01-02 21:40:51.501 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - [] - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-02 21:40:51.537 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - [] - Finished Spring Data repository scanning in 32 ms. Found 9 JPA repository interfaces.
2026-01-02 21:40:51.877 [main] INFO  o.s.boot.tomcat.TomcatWebServer - [] - Tomcat initialized with port 8080 (http)
2026-01-02 21:40:51.883 [main] INFO  o.a.coyote.http11.Http11NioProtocol - [] - Initializing ProtocolHandler ["http-nio-8080"]
2026-01-02 21:40:51.884 [main] INFO  o.a.catalina.core.StandardService - [] - Starting service [Tomcat]
2026-01-02 21:40:51.884 [main] INFO  o.a.catalina.core.StandardEngine - [] - Starting Servlet engine: [Apache Tomcat/11.0.14]
2026-01-02 21:40:51.907 [main] INFO  o.s.b.w.c.s.WebApplicationContextInitializer - [] - Root WebApplicationContext: initialization completed in 807 ms
2026-01-02 21:40:51.991 [main] INFO  o.h.jpa.internal.util.LogHelper - [] - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-02 21:40:52.018 [main] INFO  org.hibernate.Version - [] - HHH000412: Hibernate ORM core version 7.1.8.Final
2026-01-02 21:40:52.222 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - [] - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-02 21:40:52.239 [main] INFO  com.zaxxer.hikari.HikariDataSource - [] - HikariPool-1 - Starting...
2026-01-02 21:40:52.320 [main] INFO  com.zaxxer.hikari.pool.HikariPool - [] - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:policy-engine-db user=SA
2026-01-02 21:40:52.320 [main] INFO  com.zaxxer.hikari.HikariDataSource - [] - HikariPool-1 - Start completed.
2026-01-02 21:40:52.331 [main] WARN  org.hibernate.orm.deprecation - [] - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-02 21:40:52.340 [main] INFO  o.hibernate.orm.connections.pooling - [] - HHH10001005: Database info:
	Database JDBC URL [jdbc:h2:mem:policy-engine-db]
	Database driver: H2 JDBC Driver
	Database dialect: H2Dialect
	Database version: 2.4.240
	Default catalog/schema: POLICY-ENGINE-DB/PUBLIC
	Autocommit mode: undefined/unknown
	Isolation level: READ_COMMITTED [default READ_COMMITTED]
	JDBC fetch size: 100
	Pool: DatasourceConnectionProviderImpl
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-02 21:40:52.923 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - [] - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: create table audit_log (id uuid not null, action varchar(255) not null, actor_user_id varchar(255), actor_username varchar(255) not null, checksum varchar(255) not null, client_ip varchar(255), country varchar(255), failure_reason varchar(255), new_values TEXT, old_values TEXT, request_id varchar(255), resource_id varchar(255), resource_type varchar(255) not null, sensitivity_level varchar(255), session_id varchar(255), status varchar(255), timestamp timestamp(6) with time zone not null, user_agent varchar(255), primary key (id))
Hibernate: create table entitlement_actions (entitlement_id bigint not null, action varchar(255))
Hibernate: create table entitlement_resource_ids (entitlement_id bigint not null, resource_id varchar(255))
Hibernate: create table entitlements (id bigint generated by default as identity, effect enum ('ALLOW','DENY'), resource_type varchar(255), subject_id varchar(255), subject_type enum ('GROUP','ROLE','USER'), primary key (id))
Hibernate: create table groups (id bigint generated by default as identity, name varchar(255) not null, primary key (id))
Hibernate: create table policies (id bigint generated by default as identity, content TEXT, description varchar(1000), filename varchar(255) not null, git_branch varchar(255), git_path varchar(255), git_repository_url varchar(255), last_sync_time timestamp(6), name varchar(255) not null, source_type enum ('GIT','MANUAL'), status enum ('ACTIVE','ARCHIVED','DRAFT'), sync_status varchar(255), version varchar(255), primary key (id))
Hibernate: create table policy_binding_policies (policy_binding_id bigint not null, policy_id bigint)
Hibernate: create table policy_bindings (id bigint generated by default as identity, context varchar(255) not null, evaluation_mode varchar(255) not null, resource_type varchar(255) not null, primary key (id))
Hibernate: create table policy_bundle_bindings (bundle_id bigint not null, binding_id bigint)
Hibernate: create table policy_bundles (id bigint generated by default as identity, description varchar(255), entrypoint varchar(255), name varchar(255) not null, wasm_enabled boolean, primary key (id))
Hibernate: create table resource_types (id bigint generated by default as identity, base_url varchar(255), data_endpoint varchar(255), description varchar(1000), resource_key varchar(255) not null, metadata_endpoint varchar(255), name varchar(255) not null, schema_definition TEXT, primary key (id))
Hibernate: create table roles (id bigint generated by default as identity, name varchar(255) not null, primary key (id))
Hibernate: create table user_groups (user_id bigint not null, group_id bigint not null, primary key (user_id, group_id))
Hibernate: create table user_roles (user_id bigint not null, role_id bigint not null, primary key (user_id, role_id))
Hibernate: create table users (id bigint generated by default as identity, username varchar(255) not null, primary key (id))
Hibernate: create index idx_audit_timestamp on audit_log (timestamp)
Hibernate: create index idx_audit_actor on audit_log (actor_username)
Hibernate: create index idx_audit_resource on audit_log (resource_type, resource_id)
Hibernate: create index idx_audit_action on audit_log (action)
Hibernate: alter table if exists groups drop constraint if exists UK8mf0is8024pqmwjxgldfe54l7
Hibernate: alter table if exists groups add constraint UK8mf0is8024pqmwjxgldfe54l7 unique (name)
Hibernate: alter table if exists policies drop constraint if exists UK7an12g93276lw3oowku2ixory
Hibernate: alter table if exists policies add constraint UK7an12g93276lw3oowku2ixory unique (filename)
Hibernate: alter table if exists policies drop constraint if exists UKdrlrn6cuc2x42xxld6fykkusg
Hibernate: alter table if exists policies add constraint UKdrlrn6cuc2x42xxld6fykkusg unique (name)
Hibernate: alter table if exists policy_bindings drop constraint if exists UKentt4ylrc0x2edxlucwrbx8k7
Hibernate: alter table if exists policy_bindings add constraint UKentt4ylrc0x2edxlucwrbx8k7 unique (resource_type, context)
Hibernate: alter table if exists resource_types drop constraint if exists UK61u5vncvy4mog1tdu5kpsuc02
Hibernate: alter table if exists resource_types add constraint UK61u5vncvy4mog1tdu5kpsuc02 unique (resource_key)
Hibernate: alter table if exists roles drop constraint if exists UKofx66keruapi6vyqpv6f2or37
Hibernate: alter table if exists roles add constraint UKofx66keruapi6vyqpv6f2or37 unique (name)
Hibernate: alter table if exists users drop constraint if exists UKr43af9ap4edm43mmtq01oddj6
Hibernate: alter table if exists users add constraint UKr43af9ap4edm43mmtq01oddj6 unique (username)
Hibernate: alter table if exists entitlement_actions add constraint FKqtjg0r20q60ji5qpi2v5skd1j foreign key (entitlement_id) references entitlements
Hibernate: alter table if exists entitlement_resource_ids add constraint FKj0ud1i9jdv0ie5cbxqn3jcp94 foreign key (entitlement_id) references entitlements
Hibernate: alter table if exists policy_binding_policies add constraint FK8g5hvpaytbfmyva47wjtbhtqk foreign key (policy_binding_id) references policy_bindings
Hibernate: alter table if exists policy_bundle_bindings add constraint FKn99d0lqhgmljlogqk441owem7 foreign key (bundle_id) references policy_bundles
Hibernate: alter table if exists user_groups add constraint FKmrgahbb4w32n9wkjqbipttc87 foreign key (group_id) references groups
Hibernate: alter table if exists user_groups add constraint FKd37bs5u9hvbwljup24b2hin2b foreign key (user_id) references users
Hibernate: alter table if exists user_roles add constraint FKh8ciramu9cc9q3qcqiv4ue8a6 foreign key (role_id) references roles
Hibernate: alter table if exists user_roles add constraint FKhfh9dx7w3ubf1co1vdev94g3f foreign key (user_id) references users
2026-01-02 21:40:52.973 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - [] - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-02 21:40:53.022 [main] INFO  o.s.d.j.r.q.QueryEnhancerFactories - [] - Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-02 21:40:53.350 [main] WARN  o.s.b.j.a.JpaBaseConfiguration$JpaWebConfiguration - [] - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-02 21:40:53.366 [main] WARN  o.s.security.core.userdetails.User - [] - User.withDefaultPasswordEncoder() is considered unsafe for production and is only intended for sample applications.
2026-01-02 21:40:53.472 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - [] - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2026-01-02 21:40:53.880 [main] INFO  o.o.policy.engine.OpaProcessManager - [] - Starting OPA process on port 8181
2026-01-02 21:40:53.883 [main] INFO  o.o.policy.engine.OpaProcessManager - [] - OPA process started with PID: 74285
{"addrs":["localhost:8181"],"diagnostic-addrs":[],"level":"info","msg":"Initializing server.","time":"2026-01-02T21:40:53+05:30"}
{"err":"listen tcp 127.0.0.1:8181: bind: address already in use","level":"error","msg":"Listener failed.","time":"2026-01-02T21:40:53+05:30"}
2026-01-02 21:40:54.891 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - [] - Starting...
2026-01-02 21:40:54.893 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - [] - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@6fe2f6a0]]
2026-01-02 21:40:54.895 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - [] - Started.
2026-01-02 21:40:54.895 [main] INFO  o.a.coyote.http11.Http11NioProtocol - [] - Starting ProtocolHandler ["http-nio-8080"]
2026-01-02 21:40:54.927 [main] INFO  o.s.boot.tomcat.TomcatWebServer - [] - Tomcat started on port 8080 (http) with context path '/'
2026-01-02 21:40:54.934 [main] INFO  o.o.p.engine.PolicyEngineApplication - [] - Started PolicyEngineApplication in 4.12 seconds (process running for 4.302)
2026-01-02 21:41:10.134 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - [] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-02 21:41:10.134 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - [] - Initializing Servlet 'dispatcherServlet'
2026-01-02 21:41:10.136 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - [] - Completed initialization in 2 ms
Hibernate: select al1_0.id,al1_0.action,al1_0.actor_user_id,al1_0.actor_username,al1_0.checksum,al1_0.client_ip,al1_0.country,al1_0.failure_reason,al1_0.new_values,al1_0.old_values,al1_0.request_id,al1_0.resource_id,al1_0.resource_type,al1_0.sensitivity_level,al1_0.session_id,al1_0.status,al1_0.timestamp,al1_0.user_agent from audit_log al1_0 order by al1_0.timestamp desc fetch first ? rows only
2026-01-02 21:41:12.925 [http-nio-8080-exec-5] DEBUG o.o.p.engine.service.AuditService - [] - Audit log saved: CREATE - POLICY
Hibernate: insert into audit_log (action,actor_user_id,actor_username,checksum,client_ip,country,failure_reason,new_values,old_values,request_id,resource_id,resource_type,sensitivity_level,session_id,status,timestamp,user_agent,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)
2026-01-02 21:41:12.940 [http-nio-8080-exec-5] WARN  o.o.p.e.e.GlobalExceptionHandler - [36f3b03f-310b-4b38-9065-65f0179b1c98] - Functional error occurred: [VAL_002 - Filename cannot be empty] TraceId: 36f3b03f-310b-4b38-9065-65f0179b1c98
2026-01-02 21:41:13.066 [http-nio-8080-exec-6] INFO  o.o.p.e.c.PolicyBundleController - [] - Creating bundle: reference-app-bundle
Hibernate: insert into policy_bundles (description,entrypoint,name,wasm_enabled,id) values (?,?,?,?,default)
2026-01-02 21:41:13.189 [http-nio-8080-exec-8] INFO  o.o.p.e.c.PolicyBundleController - [] - Triggering build (and notification) for bundle: reference-app-bundle
Hibernate: select pb1_0.id,pb1_0.description,pb1_0.entrypoint,pb1_0.name,pb1_0.wasm_enabled from policy_bundles pb1_0 where pb1_0.name=?
2026-01-02 21:41:13.224 [http-nio-8080-exec-8] INFO  o.o.p.e.e.WebSocketEventPublisher - [] - Publishing event to WebSocket destination: /topic/bundles/reference-app-bundle
2026-01-02 21:41:13.390 [http-nio-8080-exec-9] INFO  o.o.p.e.c.PolicyBundleController - [] - Downloading bundle by id: 1
Hibernate: select pb1_0.id,pb1_0.description,pb1_0.entrypoint,pb1_0.name,pb1_0.wasm_enabled from policy_bundles pb1_0 where pb1_0.id=?
Hibernate: select bi1_0.bundle_id,bi1_0.binding_id from policy_bundle_bindings bi1_0 where bi1_0.bundle_id=?
Hibernate: select e1_0.id,e1_0.effect,e1_0.resource_type,e1_0.subject_id,e1_0.subject_type from entitlements e1_0
Hibernate: select rt1_0.id,rt1_0.base_url,rt1_0.data_endpoint,rt1_0.description,rt1_0.resource_key,rt1_0.metadata_endpoint,rt1_0.name,rt1_0.schema_definition from resource_types rt1_0
2026-01-02 21:41:53.896 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - [] - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 12, active threads = 0, queued tasks = 0, completed tasks = 12], outboundChannel[pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 4], sockJsScheduler[pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
2026-01-02 22:11:53.874 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - [] - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 12], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 4], sockJsScheduler[pool size = 2, active threads = 1, queued tasks = 0, completed tasks = 1]
